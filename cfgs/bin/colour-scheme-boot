#!/usr/bin/env sh
LOCATION=13963
rm -f ~/.config/colourscheme
while true ; do
    JSON_DATA=$(curl "https://query.yahooapis.com/v1/public/yql" \
        -d q="select astronomy.sunset,astronomy.sunrise from weather.forecast where woeid=${LOCATION}" \
        -d format=json 2>/dev/null)
    SUNRISE_TIME=$(echo $JSON_DATA | jq -r '.query.results.channel.astronomy.sunrise')
    SUNSET_TIME=$(echo $JSON_DATA | jq -r '.query.results.channel.astronomy.sunset')
    if [ "$SUNRISE_TIME" != "null" ] && [ "$SUNSET_TIME" != "null" ] ; then
        break
    fi
done

SUNRISE=$(date -d "$SUNRISE_TIME" +%s)
SUNSET=$(date -d "$SUNSET_TIME" +%s)
CURRENT_TIME=$(date +%s)
if [ $CURRENT_TIME -ge $SUNRISE ] && [ $CURRENT_TIME -le $SUNSET ] ; then
    echo "Switching to light theme."
    colour-scheme light
else
    echo "Switching to dark theme."
    colour-scheme dark
fi
